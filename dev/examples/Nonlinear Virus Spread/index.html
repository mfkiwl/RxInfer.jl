<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Nonlinear Virus Spread · RxInfer.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://biaslab.github.io/RxInfer.jl/examples/Nonlinear Virus Spread/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/theme.css" rel="stylesheet" type="text/css"/><link href="../../assets/header.css" rel="stylesheet" type="text/css"/><script src="../../assets/header.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="RxInfer.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="RxInfer.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RxInfer.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="../../manuals/getting-started/">Getting started</a></li><li><a class="tocitem" href="../../manuals/model-specification/">Model specification</a></li><li><a class="tocitem" href="../../manuals/constraints-specification/">Constraints specification</a></li><li><a class="tocitem" href="../../manuals/meta-specification/">Meta specification</a></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Inference specification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manuals/inference/overview/">Overview</a></li><li><a class="tocitem" href="../../manuals/inference/inference/">Static dataset</a></li><li><a class="tocitem" href="../../manuals/inference/rxinference/">Real-time dataset / reactive inference</a></li><li><a class="tocitem" href="../../manuals/inference/manual/">Manual inference specification</a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/functional-forms/">Built-in functional form constraints</a></li><li><a class="tocitem" href="../../library/model-specification/">Model specification</a></li><li><a class="tocitem" href="../../library/bethe-free-energy/">Bethe Free Energy</a></li><li><a class="tocitem" href="../../library/exported-methods/">Exported methods</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../Coin Toss Model/">Coin toss model (Beta-Bernoulli)</a></li><li><a class="tocitem" href="../Linear Regression/">Bayesian Linear Regression</a></li><li><a class="tocitem" href="../Active Inference Mountain car/">Active Inference Mountain car</a></li><li><a class="tocitem" href="../Assessing People Skills/">Assessing People’s Skills</a></li><li><a class="tocitem" href="../Gaussian Linear Dynamical System/">Gaussian Linear Dynamical System</a></li><li><a class="tocitem" href="../Hidden Markov Model/">Ensemble Learning of a Hidden Markov Model</a></li><li><a class="tocitem" href="../Autoregressive Model/">Autoregressive Model</a></li><li><a class="tocitem" href="../Hierarchical Gaussian Filter/">Hierarchical Gaussian Filter</a></li><li><a class="tocitem" href="../Bayesian ARMA/">Bayesian ARMA model</a></li><li><a class="tocitem" href="../Infinite Data Stream/">Infinite Data Stream</a></li><li><a class="tocitem" href="../Identification Problem/">System Identification Problem</a></li><li><a class="tocitem" href="../Gaussian Mixture Univariate/">Univariate Gaussian Mixture Model</a></li><li><a class="tocitem" href="../Gaussian Mixtures Multivariate/">Multivariate Gaussian Mixture Model</a></li><li><a class="tocitem" href="../Gamma Mixture/">Gamma Mixture Model</a></li><li><a class="tocitem" href="../Global Parameter Optimisation/">Global Parameter Optimisation</a></li><li><a class="tocitem" href="../Invertible Neural Network Tutorial/">Invertible neural networks: a tutorial</a></li><li><a class="tocitem" href="../Conjugate-Computational Variational Message Passing/">Conjugate-Computational Variational Message Passing (CVI)</a></li><li><a class="tocitem" href="../GPRegression by SSM/">Solve GP regression by SDE</a></li><li><a class="tocitem" href="../Nonlinear Noisy Pendulum/">Nonlinear Smoothing: Noisy Pendulum</a></li><li><a class="tocitem" href="../Nonlinear Rabbit Population/">Nonlinear Smoothing: Rabbit Population</a></li><li class="is-active"><a class="tocitem" href>Nonlinear Virus Spread</a><ul class="internal"><li><a class="tocitem" href="#Generate-Data"><span>Generate Data</span></a></li><li><a class="tocitem" href="#Model-specification"><span>Model specification</span></a></li><li><a class="tocitem" href="#Inference-results"><span>Inference results</span></a></li></ul></li><li><a class="tocitem" href="../Nonlinear Sensor Fusion/">Nonlinear Sensor Fusion</a></li><li><a class="tocitem" href="../Kalman filter with LSTM network driven dynamic/">Kalman filter with LSTM network driven dynamic</a></li><li><a class="tocitem" href="../Handling Missing Data/">Handling Missing Data</a></li><li><a class="tocitem" href="../Custom nonlinear node/">Custom Nonlinear Node</a></li><li><a class="tocitem" href="../Probit Model (EP)/">Probit Model (EP)</a></li><li><a class="tocitem" href="../RTS vs BIFM Smoothing/">RTS vs BIFM Smoothing</a></li><li><a class="tocitem" href="../Advanced Tutorial/">Advanced Tutorial</a></li></ul></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../../contributing/overview/">Overview</a></li><li><a class="tocitem" href="../../contributing/new-example/">Adding a new example</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Nonlinear Virus Spread</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Nonlinear Virus Spread</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/biaslab/RxInfer.jl/blob/main/docs/src/examples/Nonlinear Virus Spread.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p>This example has been auto-generated from the <a href="https://github.com/biaslab/RxInfer.jl/tree/main/examples"><code>examples/</code></a> folder at GitHub repository.</p><h1 id="examples-nonlinear-virus-spread"><a class="docs-heading-anchor" href="#examples-nonlinear-virus-spread">Nonlinear Virus Spread</a><a id="examples-nonlinear-virus-spread-1"></a><a class="docs-heading-anchor-permalink" href="#examples-nonlinear-virus-spread" title="Permalink"></a></h1><pre><code class="language-julia hljs"># Activate local environment, see `Project.toml`
import Pkg; Pkg.activate(&quot;.&quot;); Pkg.instantiate();</code></pre><p>In this demo we consider a model for the spead of a virus (not COVID-19!) in a population. We are interested in estimating the reproduction rate from daily observations of the number of infected individuals. The reproduction rate indicates how many others are (on average) infected by one infected individual per time unit.</p><pre><code class="language-julia hljs">using RxInfer, Plots, Distributions</code></pre><h2 id="Generate-Data"><a class="docs-heading-anchor" href="#Generate-Data">Generate Data</a><a id="Generate-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-Data" title="Permalink"></a></h2><p>We start by generating a toy dataset for a virus with a reproduction rate <span>$a$</span>. Here, <span>$y$</span> represents the measured number of infected individuals, and <span>$x$</span> a latent state.</p><pre><code class="language-julia hljs"># Generate toy dataset
T = 30
x_0_data = 0.6
a_data = 1.1

x_data = Vector{Float64}(undef, T)
y_data = Vector{Float64}(undef, T)

x_t_min_data = x_0_data
for t=1:T
    global x_data[t] = a_data*x_t_min_data
    global y_data[t] = ceil(x_data[t])
    global x_t_min_data = x_data[t]
end    
;</code></pre><pre><code class="language-julia hljs"># Inspect data
bar(1:T, y_data, xlabel = &quot;t [days]&quot;, ylabel = &quot;y [infected]&quot;, label = false)</code></pre><p><img src="../../assets/examples/Nonlinear Virus Spread_4_1.png" alt/></p><h2 id="Model-specification"><a class="docs-heading-anchor" href="#Model-specification">Model specification</a><a id="Model-specification-1"></a><a class="docs-heading-anchor-permalink" href="#Model-specification" title="Permalink"></a></h2><p>We define a state-space model, where we specify the state transition by a <code>g</code> function. </p><pre><code class="language-julia hljs">g(x_t_min, a) = a * x_t_min</code></pre><pre><code class="nohighlight hljs">g (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">@model function virus_spread(n)
    x = randomvar(n)
    y = datavar(Float64, n)

    a ~ NormalMeanVariance(0.0, 100.0)
    x_0 ~ NormalMeanVariance(1.0, 10.0)

    x_prev = x_0
    for i in 1:n
        x[i] ~ g(x_prev, a)
        y[i] ~ NormalMeanVariance(x[i], 0.1)
        x_prev = x[i]
    end

end</code></pre><pre><code class="language-julia hljs">meta = @meta begin 
    # `meta` specifies the approximation method, which will be used 
    # to approximate the nonlinearity
    g() -&gt; Linearization()
end</code></pre><pre><code class="nohighlight hljs">Meta specification:
  g() -&gt; Linearization()
Options:
  warn = true</code></pre><pre><code class="language-julia hljs">result = inference(
    model = virus_spread(length(y_data)), 
    data = (y = y_data,),
    meta = meta,
    options = (limit_stack_depth = 100, ),
    returnvars = KeepLast(), 
    initmessages = (a = NormalMeanVariance(0.0, 10.0), ), 
)</code></pre><pre><code class="nohighlight hljs">Inference results:
  Posteriors       | available for (a, x_0, x)</code></pre><pre><code class="language-julia hljs">m_x_t, v_x_t = mean.(result.posteriors[:x]), cov.(result.posteriors[:x]);
m_a, v_a = mean.(result.posteriors[:a]), cov.(result.posteriors[:a]);</code></pre><h2 id="Inference-results"><a class="docs-heading-anchor" href="#Inference-results">Inference results</a><a id="Inference-results-1"></a><a class="docs-heading-anchor-permalink" href="#Inference-results" title="Permalink"></a></h2><pre><code class="language-julia hljs">p1 = bar(1:T, y_data, label=false)
p1 = plot!(p1, 1:T, m_x_t, color=:black, ribbon=sqrt.(v_x_t), fillalpha=0.3, xlim=(1,T), ylabel=&quot;y [infected]&quot;, label=false)
p2 = plot(1:T, m_a*ones(T,), color=:black, ribbon=sqrt.(v_a)*ones(T,), fillalpha=0.3, xlim=(1,T), ylabel=&quot;a [repr. rate]&quot;, label=&quot;inferred&quot;)
p2 = plot!(p2, 1:T, a_data*ones(T), linestyle=:dash, label=&quot;true &quot;, ylim = (0, 2))

rθ = range(1.05, 1.15, length = 1000)

p3 = plot(title = &quot;Inference results&quot;, xlim = (1.05, 1.15))

p3 = plot!(p3, rθ, (x) -&gt; pdf(Normal(0.0, 100.0), x), fillalpha=0.3, fillrange = 0, label=&quot;P(a)&quot;, c=1,)
p3 = plot!(p3, rθ, (x) -&gt; pdf(Normal(mean(result.posteriors[:a]), var(result.posteriors[:a])), x), fillalpha=0.3, fillrange = 0, label=&quot;P(a|y)&quot;, c=3)
p3 = vline!(p3, [ a_data ], label=&quot;Real θ&quot;, linestyle=:dash, color = :red)

plot(p1, p2, p3,  layout = @layout([a; b c]))</code></pre><p><img src="../../assets/examples/Nonlinear Virus Spread_10_1.png" alt/></p><p>As we can see the inference results match hidden states with high precision, as well as for the <code>a</code> parameter.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Nonlinear Rabbit Population/">« Nonlinear Smoothing: Rabbit Population</a><a class="docs-footer-nextpage" href="../Nonlinear Sensor Fusion/">Nonlinear Sensor Fusion »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 12 December 2022 08:41">Monday 12 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
