<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Static dataset · RxInfer.jl</title><script data-outdated-warner src="../../../assets/warner.js"></script><link rel="canonical" href="https://biaslab.github.io/RxInfer.jl/manuals/inference/inference/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/theme.css" rel="stylesheet" type="text/css"/><link href="../../../assets/header.css" rel="stylesheet" type="text/css"/><script src="../../../assets/header.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img class="docs-light-only" src="../../../assets/logo.svg" alt="RxInfer.jl logo"/><img class="docs-dark-only" src="../../../assets/logo-dark.svg" alt="RxInfer.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">RxInfer.jl</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="../../getting-started/">Getting started</a></li><li><a class="tocitem" href="../../model-specification/">Model specification</a></li><li><a class="tocitem" href="../../constraints-specification/">Constraints specification</a></li><li><a class="tocitem" href="../../meta-specification/">Meta specification</a></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox" checked/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Inference specification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li class="is-active"><a class="tocitem" href>Static dataset</a></li><li><a class="tocitem" href="../rxinference/">Real-time dataset / reactive inference</a></li><li><a class="tocitem" href="../manual/">Manual inference specification</a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../../library/functional-forms/">Built-in functional form constraints</a></li><li><a class="tocitem" href="../../../library/model-specification/">Model specification</a></li><li><a class="tocitem" href="../../../library/bethe-free-energy/">Bethe Free Energy</a></li><li><a class="tocitem" href="../../../library/exported-methods/">Exported methods</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../../examples/overview/">Overview</a></li><li><a class="tocitem" href="../../../examples/Advanced Tutorial/">Advanced Tutorial</a></li><li><a class="tocitem" href="../../../examples/Assessing People Skills/">Assessing People Skills</a></li><li><a class="tocitem" href="../../../examples/Autoregressive Model/">Autoregressive Model</a></li><li><a class="tocitem" href="../../../examples/Coin Toss Model/">Coin Toss Model</a></li><li><a class="tocitem" href="../../../examples/Conjugate-Computational Variational Message Passing/">Conjugate-Computational Variational Message Passing</a></li><li><a class="tocitem" href="../../../examples/Custom nonlinear node/">Custom nonlinear node</a></li><li><a class="tocitem" href="../../../examples/GPRegression by SSM/">GPRegression by SSM</a></li><li><a class="tocitem" href="../../../examples/Gamma Mixture/">Gamma Mixture</a></li><li><a class="tocitem" href="../../../examples/Gaussian Linear Dynamical System/">Gaussian Linear Dynamical System</a></li><li><a class="tocitem" href="../../../examples/Gaussian Mixture Univariate/">Gaussian Mixture Univariate</a></li><li><a class="tocitem" href="../../../examples/Gaussian Mixtures Multivariate/">Gaussian Mixtures Multivariate</a></li><li><a class="tocitem" href="../../../examples/Global Parameter Optimisation/">Global Parameter Optimisation</a></li><li><a class="tocitem" href="../../../examples/Handling Missing Data/">Handling Missing Data</a></li><li><a class="tocitem" href="../../../examples/Hidden Markov Model/">Hidden Markov Model</a></li><li><a class="tocitem" href="../../../examples/Hierarchical Gaussian Filter/">Hierarchical Gaussian Filter</a></li><li><a class="tocitem" href="../../../examples/Identification Problem/">Identification Problem</a></li><li><a class="tocitem" href="../../../examples/Infinite Data Stream/">Infinite Data Stream</a></li><li><a class="tocitem" href="../../../examples/Invertible Neural Network Tutorial/">Invertible Neural Network Tutorial</a></li><li><a class="tocitem" href="../../../examples/Kalman filter with LSTM network driven dynamic/">Kalman filter with LSTM network driven dynamic</a></li><li><a class="tocitem" href="../../../examples/Linear Regression/">Linear Regression</a></li><li><a class="tocitem" href="../../../examples/Nonlinear Noisy Pendulum/">Nonlinear Noisy Pendulum</a></li><li><a class="tocitem" href="../../../examples/Nonlinear Rabbit Population/">Nonlinear Rabbit Population</a></li><li><a class="tocitem" href="../../../examples/Nonlinear Sensor Fusion/">Nonlinear Sensor Fusion</a></li><li><a class="tocitem" href="../../../examples/Nonlinear Virus Spread/">Nonlinear Virus Spread</a></li><li><a class="tocitem" href="../../../examples/Probit Model (EP)/">Probit Model (EP)</a></li><li><a class="tocitem" href="../../../examples/RTS vs BIFM Smoothing/">RTS vs BIFM Smoothing</a></li></ul></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../../../contributing/overview/">Overview</a></li><li><a class="tocitem" href="../../../contributing/new-example/">Adding a new example</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User guide</a></li><li><a class="is-disabled">Inference specification</a></li><li class="is-active"><a href>Static dataset</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Static dataset</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/biaslab/RxInfer.jl/blob/main/docs/src/manuals/inference/inference.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="user-guide-inference"><a class="docs-heading-anchor" href="#user-guide-inference">Automatic inference specification on static datasets</a><a id="user-guide-inference-1"></a><a class="docs-heading-anchor-permalink" href="#user-guide-inference" title="Permalink"></a></h1><p><code>RxInfer</code> exports the <code>inference</code> function to quickly run and test you model with static datasets. Note, however, that this function does cover almost all capabilities of the inference engine, but for advanced use cases you may want to resort to the <a href="../overview/#user-guide-inference-execution-manual-specification">manual inference specification</a>. </p><p>For running inference on real-time datasets see the <a href="../rxinference/#user-guide-rxinference">Reactive Inference</a> section. For manual inference specification see the <a href="../manual/#user-guide-manual-inference">Manual Inference</a> section.</p><article class="docstring"><header><a class="docstring-binding" id="RxInfer.inference" href="#RxInfer.inference"><code>RxInfer.inference</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">inference(
    model; 
    data,
    initmarginals           = nothing,
    initmessages            = nothing,
    constraints             = nothing,
    meta                    = nothing,
    options                 = nothing,
    returnvars              = nothing, 
    iterations              = nothing,
    free_energy             = false,
    free_energy_diagnostics = BetheFreeEnergyDefaultChecks,
    showprogress            = false,
    callbacks               = nothing,
)</code></pre><p>This function provides a generic way to perform probabilistic inference in RxInfer.jl. Returns <code>InferenceResult</code>.</p><p><strong>Arguments</strong></p><p>For more information about some of the arguments, please check below.</p><ul><li><code>model</code>: specifies a model generator, required</li><li><code>data</code>: <code>NamedTuple</code> or <code>Dict</code> with data, required</li><li><code>initmarginals = nothing</code>: <code>NamedTuple</code> or <code>Dict</code> with initial marginals, optional</li><li><code>initmessages = nothing</code>: <code>NamedTuple</code> or <code>Dict</code> with initial messages, optional</li><li><code>constraints = nothing</code>: constraints specification object, optional, see <code>@constraints</code></li><li><code>meta  = nothing</code>: meta specification object, optional, may be required for some models, see <code>@meta</code></li><li><code>options = nothing</code>: model creation options, optional, see <code>ModelInferenceOptions</code></li><li><code>returnvars = nothing</code>: return structure info, optional, defaults to return everything at each iteration, see below for more information</li><li><code>iterations = nothing</code>: number of iterations, optional, defaults to <code>nothing</code>, the inference engine does not distinguish between variational message passing or Loopy belief propagation or expectation propagation iterations, see below for more information</li><li><code>free_energy = false</code>: compute the Bethe free energy, optional, defaults to false. Can be passed a floating point type, e.g. <code>Float64</code>, for better efficiency, but disables automatic differentiation packages, such as ForwardDiff.jl</li><li><code>free_energy_diagnostics = BetheFreeEnergyDefaultChecks</code>: free energy diagnostic checks, optional, by default checks for possible <code>NaN</code>s and <code>Inf</code>s. <code>nothing</code> disables all checks.</li><li><code>showprogress = false</code>: show progress module, optional, defaults to false</li><li><code>callbacks = nothing</code>: inference cycle callbacks, optional, see below for more info</li><li><code>warn = true</code>: enables/disables warnings</li></ul><p><strong>Note on NamedTuples</strong></p><p>When passing <code>NamedTuple</code> as a value for some argument, make sure you use a trailing comma for <code>NamedTuple</code>s with a single entry. The reason is that Julia treats <code>returnvars = (x = KeepLast())</code> and <code>returnvars = (x = KeepLast(), )</code> expressions differently. This first expression creates (or <strong>overwrites!</strong>) new local/global variable named <code>x</code> with contents <code>KeepLast()</code>. The second expression (note trailing comma) creates <code>NamedTuple</code> with <code>x</code> as a key and <code>KeepLast()</code> as a value assigned for this key.</p><p><strong>Extended information about some of the arguments</strong></p><ul><li><h3><code>model</code></h3></li></ul><p>The <code>model</code> argument accepts a <code>ModelGenerator</code> as its input. The easiest way to create the <code>ModelGenerator</code> is to use the <code>@model</code> macro.  For example:</p><pre><code class="language-julia hljs">@model function coin_toss(some_argument, some_keyword_argument = 3)
   ...
end

result = inference(
    model = coin_toss(some_argument; some_keyword_argument = 3)
)</code></pre><p><strong>Note</strong>: The <code>model</code> keyword argument does not accept a <code>FactorGraphModel</code> instance as a value, as it needs to inject <code>constraints</code> and <code>meta</code> during the inference procedure.</p><ul><li><h3><code>data</code></h3></li></ul><p>The <code>data</code> keyword argument must be a <code>NamedTuple</code> (or <code>Dict</code>) where keys (of <code>Symbol</code> type) correspond to all <code>datavar</code>s defined in the model specification. For example, if a model defines <code>x = datavar(Float64)</code> the  <code>data</code> field must have an <code>:x</code> key (of <code>Symbol</code> type) which holds a value of type <code>Float64</code>. The values in the <code>data</code> must have the exact same shape as the <code>datavar</code> container. In other words, if a model defines <code>x = datavar(Float64, n)</code> then  <code>data[:x]</code> must provide a container with length <code>n</code> and with elements of type <code>Float64</code>.</p><p><strong>Note</strong>: The behavior of the <code>data</code> keyword argument is different from that which is used in the <code>rxinference</code> function.</p><ul><li><h3><code>initmarginals</code></h3></li></ul><p>In general for variational message passing every marginal distribution in a model needs to be pre-initialised. In practice, however, for many models it is sufficient enough to initialise only a small subset of variables in the model.</p><ul><li><h3><code>initmessages</code></h3></li></ul><p>Loopy belief propagation may need some messages in a model to be pre-initialised.</p><ul><li><h3><code>options</code></h3></li><li><p><code>limit_stack_depth</code>: limits the stack depth for computing messages, helps with <code>StackOverflowError</code> for large models, but reduces the performance of the inference backend. Accepts integer as an argument that specifies the maximum number of recursive depth. Lower is better for stack overflow error, but worse for performance.</p></li><li><p><code>pipeline</code>: changes the default pipeline for each factor node in the graph</p></li><li><p><code>global_reactive_scheduler</code>: changes the scheduler of reactive streams, see Rocket.jl for more info, defaults to no scheduler</p></li><li><h3><code>returnvars</code></h3></li></ul><p><code>returnvars</code> specifies the variables of interests and the amount of information to return about their posterior updates. </p><p><code>returnvars</code> accepts a <code>NamedTuple</code> or <code>Dict</code> or return var specification. There are two specifications:</p><ul><li><code>KeepLast</code>: saves the last update for a variable, ignoring any intermediate results during iterations</li><li><code>KeepEach</code>: saves all updates for a variable for all iterations</li></ul><p>Note: if <code>iterations</code> are specified as a number, the <code>inference</code> function tracks and returns every update for each iteration for every random variable in the model (equivalent to <code>KeepEach()</code>). If number of iterations is set to <code>nothing</code>, the <code>inference</code> function saves the &#39;last&#39; (and the only one) update for every random variable in the model (equivalent to <code>KeepLast()</code>).  Use <code>iterations = 1</code> to force <code>KeepEach()</code> setting when number of iterations is equal to <code>1</code> or set <code>returnvars = KeepEach()</code> manually.</p><p>Example: </p><pre><code class="language-julia hljs">result = inference(
    ...,
    returnvars = (
        x = KeepLast(),
        τ = KeepEach()
    )
)</code></pre><p>It is also possible to set either <code>returnvars = KeepLast()</code> or <code>returnvars = KeepEach()</code> that acts as an alias and sets the given option for <strong>all</strong> random variables in the model.</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs">result = inference(
    ...,
    returnvars = KeepLast()
)</code></pre><ul><li><h3><code>iterations</code></h3></li></ul><p>Specifies the number of variational (or loopy belief propagation) iterations. By default set to <code>nothing</code>, which is equivalent of doing 1 iteration. </p><ul><li><h3><code>free_energy</code></h3></li></ul><p>This setting specifies whenever the <code>inference</code> function should return Bethe Free Energy (BFE) values.  Note, however, that it may be not possible to compute BFE values for every model. </p><p>Additionally, the argument may accept a floating point type, instead of a <code>Bool</code> value. Using his option, e.g.<code>Float64</code>, improves performance of Bethe Free Energy computation, but restricts using automatic differentiation packages.</p><ul><li><h3><code>free_energy_diagnostics</code></h3></li></ul><p>This settings specifies either a single or a tuple of diagnostic checks for Bethe Free Energy values stream. By default checks for <code>NaN</code>s and <code>Inf</code>s. See also <a href="../../../library/bethe-free-energy/#RxInfer.BetheFreeEnergyCheckNaNs"><code>BetheFreeEnergyCheckNaNs</code></a> and <a href="../../../library/bethe-free-energy/#RxInfer.BetheFreeEnergyCheckInfs"><code>BetheFreeEnergyCheckInfs</code></a>. Pass <code>nothing</code> to disable any checks.</p><ul><li><h3><code>callbacks</code></h3></li></ul><p>The inference function has its own lifecycle. The user is free to provide some (or none) of the callbacks to inject some extra logging or other procedures in the inference function, e.g.</p><pre><code class="language-julia hljs">result = inference(
    ...,
    callbacks = (
        on_marginal_update = (model, name, update) -&gt; println(&quot;$(name) has been updated: $(update)&quot;),
        after_inference    = (args...) -&gt; println(&quot;Inference has been completed&quot;)
    )
)</code></pre><p>The <code>callbacks</code> keyword argument accepts a named-tuple of &#39;name = callback&#39; pairs.  The list of all possible callbacks and their arguments is present below:</p><ul><li><code>on_marginal_update</code>:    args: (model::FactorGraphModel, name::Symbol, update)</li><li><code>before_model_creation</code>: args: ()</li><li><code>after_model_creation</code>:  args: (model::FactorGraphModel, returnval)</li><li><code>before_inference</code>:      args: (model::FactorGraphModel)</li><li><code>before_iteration</code>:      args: (model::FactorGraphModel, iteration::Int)</li><li><code>before_data_update</code>:    args: (model::FactorGraphModel, data)</li><li><code>after_data_update</code>:     args: (model::FactorGraphModel, data)</li><li><code>after_iteration</code>:       args: (model::FactorGraphModel, iteration::Int)</li><li><code>after_inference</code>:       args: (model::FactorGraphModel)</li></ul><p>See also: <a href="#RxInfer.InferenceResult"><code>InferenceResult</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/biaslab/RxInfer.jl/blob/a7cb2cecab20e60aed9a3fe29da8bcf3b85ee086/src/inference.jl#L201-L363">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="RxInfer.InferenceResult" href="#RxInfer.InferenceResult"><code>RxInfer.InferenceResult</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">InferenceResult</code></pre><p>This structure is used as a return value from the <a href="#RxInfer.inference"><code>inference</code></a> function. </p><p><strong>Public Fields</strong></p><ul><li><code>posteriors</code>: <code>Dict</code> or <code>NamedTuple</code> of &#39;random variable&#39; - &#39;posterior&#39; pairs. See the <code>returnvars</code> argument for <a href="#RxInfer.inference"><code>inference</code></a>.</li><li><code>free_energy</code>: (optional) An array of Bethe Free Energy values per VMP iteration. See the <code>free_energy</code> argument for <a href="#RxInfer.inference"><code>inference</code></a>.</li><li><code>model</code>: <code>FactorGraphModel</code> object reference.</li><li><code>returnval</code>: Return value from executed <code>@model</code>.</li></ul><p>See also: <a href="#RxInfer.inference"><code>inference</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/biaslab/RxInfer.jl/blob/a7cb2cecab20e60aed9a3fe29da8bcf3b85ee086/src/inference.jl#L136-L149">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../overview/">« Overview</a><a class="docs-footer-nextpage" href="../rxinference/">Real-time dataset / reactive inference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 24 November 2022 09:14">Thursday 24 November 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
